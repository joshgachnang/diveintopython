
<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" >
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>14.4.Â roman.py, stage 4</title>
        <link rev="made" href="josh@servercobra.com" />
        <meta name="generator" content="convert_to_jinja2.py" />
        <meta name="keywords" content="Python, Dive Into Python, tutorial, object-oriented, programming, documentation, book, free" />
        <meta name="description" content="Python from novice to pro" />
        <link rel="home" href="http://www.diveintopython.net/" title="Dive Into Python" />
        
    
    <link rel="up" href="stage_1.html" title=" Chapter14.Test-First Programming" />
    
    
    
    <link rel="next" href="stage_5.html" title=" 14.5.roman.py, stage 5" />
    

        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/foundation.css">
        <link rel="stylesheet" href="../css/diveintopython.css" type="text/css" />
        <script src="../js/modernizr.js"></script>
    </head>
    <body>
        <div class="row">
            <div class="small-12 columns" id="Header">
                <div class="row">
                    <div class="small-11 columns">
                        
    
    <td align="left" colspan="5" id="breadcrumb" valign="top">You are here: <a href="../index.html">Home</a>&#160;&gt;&#160;<a href="../toc/index.html">Dive Into Python</a>&#160;&gt;&#160;<a href="stage_1.html">Test-First Programming</a>&#160;&gt;&#160;<span class="thispage">roman.py, stage 4</span></td>
    

                    </div>
                    <div class="small-1 columns">
                        
    <td align="right" id="navigation" valign="top">&#160;&#160;&#160;<a href="stage_3.html" title="Prev: &#8220;roman.py, stage 3&#8221;">&lt;&lt;</a>&#160;&#160;&#160;<a href="stage_5.html" title="Next: &#8220;roman.py, stage 5&#8221;">&gt;&gt;</a></td>

                    </div>
                </div>

                <div id="logocontainer">
                    <h1 id="logo"><a href="http://www.diveintopython.net/index.html" accesskey="1">Dive Into Python</a></h1>
                    <p id="tagline">Python from novice to pro</p>
                    <a href="http://www.amazon.com/gp/product/B001GIOFN8/ref=as_li_tf_tl?ie=UTF8&tag=diveintopython-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=B001GIOFN8"><img src="../images/amazon-buy-button.gif"></a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    <div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="roman.stage4"></a>14.4.&#160;<tt class="filename">roman.py</tt>, stage 4
                  </h2>
</div>
</div>
<div></div>
</div>
<div class="abstract">
<p>Now that <tt class="function">toRoman</tt> is done, it's time to start coding <tt class="function">fromRoman</tt>.  Thanks to the rich data structure that maps individual Roman numerals to integer values, this is no more difficult than
               the <tt class="function">toRoman</tt> function.
            </p>
</div>
<div class="example"><a name="d0e33582"></a><h3 class="title">Example&#160;14.9.&#160;<tt class="filename">roman4.py</tt></h3>
<p>This file is available in <tt class="filename">py/roman/stage4/</tt> in the examples directory.
            </p>
<p>If you have not already done so, you can <a href="http://diveintopython.org/download/diveintopython-examples-5.4.zip" title="Download example scripts">download this and other examples</a> used in this book.
            </p><pre class="programlisting">
<span class="pystring">"""Convert to and from Roman numerals"""</span>

<span class="pycomment">#Define exceptions</span>
<span class="pykeyword">class</span><span class="pyclass"> RomanError</span>(Exception): <span class="pykeyword">pass</span>
<span class="pykeyword">class</span><span class="pyclass"> OutOfRangeError</span>(RomanError): <span class="pykeyword">pass</span>
<span class="pykeyword">class</span><span class="pyclass"> NotIntegerError</span>(RomanError): <span class="pykeyword">pass</span>
<span class="pykeyword">class</span><span class="pyclass"> InvalidRomanNumeralError</span>(RomanError): <span class="pykeyword">pass</span>

<span class="pycomment">#Define digit mapping</span>
romanNumeralMap = ((<span class="pystring">'M'</span>,  1000),
                   (<span class="pystring">'CM'</span>, 900),
                   (<span class="pystring">'D'</span>,  500),
                   (<span class="pystring">'CD'</span>, 400),
                   (<span class="pystring">'C'</span>,  100),
                   (<span class="pystring">'XC'</span>, 90),
                   (<span class="pystring">'L'</span>,  50),
                   (<span class="pystring">'XL'</span>, 40),
                   (<span class="pystring">'X'</span>,  10),
                   (<span class="pystring">'IX'</span>, 9),
                   (<span class="pystring">'V'</span>,  5),
                   (<span class="pystring">'IV'</span>, 4),
                   (<span class="pystring">'I'</span>,  1))

<span class="pycomment"># toRoman function omitted for clarity (it hasn't changed)</span>

<span class="pykeyword">def</span><span class="pyclass"> fromRoman</span>(s):
    <span class="pystring">"""convert Roman numeral to integer"""</span>
    result = 0
    index = 0
    <span class="pykeyword">for</span> numeral, integer <span class="pykeyword">in</span> romanNumeralMap:
        <span class="pykeyword">while</span> s[index:index+len(numeral)] == numeral: <a name="roman.stage4.1.1"></a><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12">
            result += integer
            index += len(numeral)
    <span class="pykeyword">return</span> result
</img></pre><div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="12"><a href="#roman.stage4.1.1"><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12"/></a>
</td>
<td align="left" valign="top">The pattern here is the same as <a href="stage_2.html#roman.stage2.example" title="Example&#160;14.3.&#160;roman2.py"><tt class="function">toRoman</tt></a>.  You iterate through your Roman numeral data structure (a tuple of tuples), and instead of matching the highest integer
                        values as often as possible, you match the &#8220;<span class="quote">highest</span>&#8221; Roman numeral character strings as often as possible.
                     </td>
</tr>
</table>
</div>
</div>
<div class="example"><a name="d0e33611"></a><h3 class="title">Example&#160;14.10.&#160;How <tt class="function">fromRoman</tt> works
            </h3>
<p>If you're not clear how <tt class="function">fromRoman</tt> works, add a <tt class="function">print</tt> statement to the end of the <tt class="literal">while</tt> loop:
            </p><pre class="programlisting">
        <span class="pykeyword">while</span> s[index:index+len(numeral)] == numeral:
            result += integer
            index += len(numeral)
            <span class="pykeyword">print</span> <span class="pystring">'found'</span>, numeral, <span class="pystring">'of length'</span>, len(numeral), <span class="pystring">', adding'</span>, integer</pre><pre class="screen">
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput"><span class="pykeyword">import</span> roman4</span>
<tt class="prompt">&gt;&gt;&gt; </tt><span class="userinput">roman4.fromRoman(<span class="pystring">'MCMLXXII'</span>)</span>
<span class="computeroutput">found M , of length 1, adding 1000
found CM , of length 2, adding 900
found L , of length 1, adding 50
found X , of length 1, adding 10
found X , of length 1, adding 10
found I , of length 1, adding 1
found I , of length 1, adding 1
1972</span></pre></div>
<div class="example"><a name="d0e33644"></a><h3 class="title">Example&#160;14.11.&#160;Output of <tt class="filename">romantest4.py</tt> against <tt class="filename">roman4.py</tt></h3><pre class="screen"><span class="computeroutput">fromRoman should only accept uppercase input ... FAIL
toRoman should always return uppercase ... ok
fromRoman should fail with malformed antecedents ... FAIL
fromRoman should fail with repeated pairs of numerals ... FAIL
fromRoman should fail with too many repeated numerals ... FAIL
fromRoman should give known result with known input ... ok </span><a name="roman.stage4.2.1"></a><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12"><span class="computeroutput">
toRoman should give known result with known input ... ok
fromRoman(toRoman(n))==n for all n ... ok                  </span><a name="roman.stage4.2.2"></a><img alt="2" border="0" height="12" src="../images/callouts/2.png" width="12"><span class="computeroutput">
toRoman should fail with non-integer input ... ok
toRoman should fail with negative input ... ok
toRoman should fail with large input ... ok
toRoman should fail with 0 input ... ok</span></img></img></pre><div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="12"><a href="#roman.stage4.2.1"><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12"/></a>
</td>
<td align="left" valign="top">Two pieces of exciting news here.  The first is that <tt class="function">fromRoman</tt> works for good input, at least for all the <a href="testing_for_success.html#roman.testtoromanknownvalues.example" title="Example&#160;13.2.&#160;testToRomanKnownValues">known values</a> you test.
                     </td>
</tr>
<tr>
<td align="left" valign="top" width="12"><a href="#roman.stage4.2.2"><img alt="2" border="0" height="12" src="../images/callouts/2.png" width="12"/></a>
</td>
<td align="left" valign="top">The second is that the <a href="testing_for_sanity.html#roman.sanity.example" title="Example&#160;13.5.&#160;Testing toRoman against fromRoman">sanity check</a> also passed.  Combined with the known values tests, you can be reasonably sure that both <tt class="function">toRoman</tt> and <tt class="function">fromRoman</tt> work properly for all possible good values.  (This is not guaranteed; it is theoretically possible that <tt class="function">toRoman</tt> has a bug that produces the wrong Roman numeral for some particular set of inputs, <span class="emphasis"><em>and</em></span> that <tt class="function">fromRoman</tt> has a reciprocal bug that produces the same wrong integer values for exactly that set of Roman numerals that <tt class="function">toRoman</tt> generated incorrectly.  Depending on your application and your requirements, this possibility may bother you; if so, write
                        more comprehensive test cases until it doesn't bother you.)
                     </td>
</tr>
</table>
</div><pre class="screen"><span class="computeroutput">
======================================================================
FAIL: fromRoman should only accept uppercase input
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 156, in testFromRomanCase
    roman4.fromRoman, numeral.lower())
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with malformed antecedents
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 133, in testMalformedAntecedent
    self.assertRaises(roman4.InvalidRomanNumeralError, roman4.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with repeated pairs of numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 127, in testRepeatedPairs
    self.assertRaises(roman4.InvalidRomanNumeralError, roman4.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
======================================================================
FAIL: fromRoman should fail with too many repeated numerals
----------------------------------------------------------------------
</span><span class="traceback">Traceback (most recent call last):
  File "C:\docbook\dip\py\roman\stage4\romantest4.py", line 122, in testTooManyRepeatedNumerals
    self.assertRaises(roman4.InvalidRomanNumeralError, roman4.fromRoman, s)
  File "c:\python21\lib\unittest.py", line 266, in failUnlessRaises
    raise self.failureException, excName
AssertionError: InvalidRomanNumeralError</span><span class="computeroutput">
----------------------------------------------------------------------
Ran 12 tests in 1.222s

FAILED (failures=4)</span></pre></div>
</div>

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        
    <table border="0" cellpadding="0" cellspacing="0" class="Footer" summary="" width="100%">
<tr>
<td align="left" width="35%"><br><a class="NavigationArrow" href="stage_3.html">&lt;&lt;&#160;roman.py, stage 3</a></br></td>
<td align="center" width="30%"><br>&#160;<span class="divider">|</span>&#160;<a href="stage_1.html#roman.stage1" title="14.1.&#160;roman.py, stage 1">1</a> <span class="divider">|</span> <a href="stage_2.html" title="14.2.&#160;roman.py, stage 2">2</a> <span class="divider">|</span> <a href="stage_3.html" title="14.3.&#160;roman.py, stage 3">3</a> <span class="divider">|</span> <span class="thispage">4</span> <span class="divider">|</span> <a href="stage_5.html" title="14.5.&#160;roman.py, stage 5">5</a>&#160;<span class="divider">|</span>&#160;
            </br></td>
<td align="right" width="35%"><br><a class="NavigationArrow" href="stage_5.html">roman.py, stage 5&#160;&gt;&gt;</a></br></td>
</tr>
<tr>
<td colspan="3"><br/></td>
</tr>
</table>

        <!-- Footer -->
<div class="Footer">
    <p><a href="https://github.com/pcsforeducation/diveintopython/issues?sort=created&state=open">Report issues<img style="margin-left:10px" height="40" src="../images/logo_github.png"></a></p>
    <p class="copyright">Copyright &copy; 2000, 2001, 2002, 2003, 2004 <a href="mailto:josh@servercobra.com">Mark Pilgrim</a>. Maintained by Josh Gachnang.</p>
</div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-1879314568120827";
/* DiveIntoPython */
google_ad_slot = "8002881514";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<!-- End Footer -->
            </div>
        </div>
        <!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- End Google Analytics -->
        <script src="../js/jquery.js"></script>
        <script src="../js/foundation.min.js"></script>
        <script>
          $(document).foundation();
        </script>
    </body>
</html>