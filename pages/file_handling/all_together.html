
<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]-->
<html class="no-js" lang="en" >
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>6.6.Â Putting It All Together</title>
        <link rev="made" href="josh@servercobra.com" />
        <meta name="generator" content="convert_to_jinja2.py" />
        <meta name="keywords" content="Python, Dive Into Python, tutorial, object-oriented, programming, documentation, book, free" />
        <meta name="description" content="Python from novice to pro" />
        <link rel="home" href="http://www.diveintopython.net/" title="Dive Into Python" />
        
    
    <link rel="up" href="index.html" title=" Chapter6.Exceptions and File Handling" />
    
    
    
    <link rel="next" href="summary.html" title=" 6.7.Summary" />
    

        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/foundation.css">
        <link rel="stylesheet" href="../css/diveintopython.css" type="text/css" />
        <script src="../js/modernizr.js"></script>
    </head>
    <body>
        <div class="row">
            <div class="small-12 columns" id="Header">
                <div class="row">
                    <div class="small-11 columns">
                        
    
    <td align="left" colspan="5" id="breadcrumb" valign="top">You are here: <a href="../index.html">Home</a>&#160;&gt;&#160;<a href="../toc/index.html">Dive Into Python</a>&#160;&gt;&#160;<a href="index.html">Exceptions and File Handling</a>&#160;&gt;&#160;<span class="thispage">Putting It All Together</span></td>
    

                    </div>
                    <div class="small-1 columns">
                        
    <td align="right" id="navigation" valign="top">&#160;&#160;&#160;<a href="os_module.html" title="Prev: &#8220;Working with Directories&#8221;">&lt;&lt;</a>&#160;&#160;&#160;<a href="summary.html" title="Next: &#8220;Summary&#8221;">&gt;&gt;</a></td>

                    </div>
                </div>

                <div id="logocontainer">
                    <h1 id="logo"><a href="http://www.diveintopython.net/index.html" accesskey="1">Dive Into Python</a></h1>
                    <p id="tagline">Python from novice to pro</p>
                    <a href="http://www.amazon.com/gp/product/B001GIOFN8/ref=as_li_tf_tl?ie=UTF8&tag=diveintopython-20&linkCode=as2&camp=1789&creative=9325&creativeASIN=B001GIOFN8"><img src="../images/amazon-buy-button.gif"></a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
                
    <div class="section" lang="en">
<div class="titlepage">
<div>
<div>
<h2 class="title"><a name="fileinfo.alltogether"></a>6.6.&#160;Putting It All Together
                  </h2>
</div>
</div>
<div></div>
</div>
<div class="abstract">
<p>Once again, all the dominoes are in place.  You've seen how each line of code works.  Now let's step back and see how it all
               fits together.
            </p>
</div>
<div class="example"><a name="fileinfo.nested"></a><h3 class="title">Example&#160;6.21.&#160;<tt class="function">listDirectory</tt></h3><pre class="programlisting"><span class="pykeyword">
def</span> listDirectory(directory, fileExtList):                                         <a name="fileinfo.alltogether.1.1"></a><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12">
    <span class="pystring">"get list of file info objects for files of particular extensions"</span>
    fileList = [os.path.normcase(f)
                <span class="pykeyword">for</span> f <span class="pykeyword">in</span> os.listdir(directory)]           
    fileList = [os.path.join(directory, f) 
               <span class="pykeyword">for</span> f <span class="pykeyword">in</span> fileList
                <span class="pykeyword">if</span> os.path.splitext(f)[1] <span class="pykeyword">in</span> fileExtList]                          <a name="fileinfo.alltogether.1.2"></a><img alt="2" border="0" height="12" src="../images/callouts/2.png" width="12">
    <span class="pykeyword">def</span><span class="pyclass"> getFileInfoClass</span>(filename, module=sys.modules[FileInfo.__module__]):       <a name="fileinfo.alltogether.1.3"></a><img alt="3" border="0" height="12" src="../images/callouts/3.png" width="12">
        <span class="pystring">"get file info class from filename extension"</span>                             
        subclass = <span class="pystring">"%sFileInfo"</span> % os.path.splitext(filename)[1].upper()[1:]        <a name="fileinfo.alltogether.1.4"></a><img alt="4" border="0" height="12" src="../images/callouts/4.png" width="12">
        <span class="pykeyword">return</span> hasattr(module, subclass) <span class="pykeyword">and</span> getattr(module, subclass) <span class="pykeyword">or</span> FileInfo <a name="fileinfo.alltogether.1.5"></a><img alt="5" border="0" height="12" src="../images/callouts/5.png" width="12">
    <span class="pykeyword">return</span> [getFileInfoClass(f)(f) <span class="pykeyword">for</span> f <span class="pykeyword">in</span> fileList]                              <a name="fileinfo.alltogether.1.6"></a><img alt="6" border="0" height="12" src="../images/callouts/6.png" width="12"/></img></img></img></img></img></pre><div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="12"><a href="#fileinfo.alltogether.1.1"><img alt="1" border="0" height="12" src="../images/callouts/1.png" width="12"/></a>
</td>
<td align="left" valign="top"><tt class="function">listDirectory</tt> is the main attraction of this entire module.  It takes a directory (like <tt class="filename">c:\music\_singles\</tt> in my case) and a list of interesting file extensions (like <tt class="literal">['.mp3']</tt>), and it returns a list of class instances that act like dictionaries that contain metadata about each interesting file in
                        that directory.  And it does it in just a few straightforward lines of code.
                     </td>
</tr>
<tr>
<td align="left" valign="top" width="12"><a href="#fileinfo.alltogether.1.2"><img alt="2" border="0" height="12" src="../images/callouts/2.png" width="12"/></a>
</td>
<td align="left" valign="top">As you saw in the <a href="os_module.html" title="6.5.&#160;Working with Directories">previous section</a>, this line of code gets a list of the full pathnames of all the files in <tt class="varname">directory</tt> that have an interesting file extension (as specified by <tt class="varname">fileExtList</tt>).
                     </td>
</tr>
<tr>
<td align="left" valign="top" width="12"><a href="#fileinfo.alltogether.1.3"><img alt="3" border="0" height="12" src="../images/callouts/3.png" width="12"/></a>
</td>
<td align="left" valign="top">Old-school <span class="application">Pascal</span> programmers may be familiar with them, but most people give me a blank stare when I tell them that <span class="application">Python</span> supports <span class="emphasis"><em>nested functions</em></span> -- literally, a function within a function.  The nested function <tt class="function">getFileInfoClass</tt> can be called only from the function in which it is defined, <tt class="function">listDirectory</tt>.  As with any other function, you don't need an interface declaration or anything fancy; just define the function and code
                        it.
                     </td>
</tr>
<tr>
<td align="left" valign="top" width="12"><a href="#fileinfo.alltogether.1.4"><img alt="4" border="0" height="12" src="../images/callouts/4.png" width="12"/></a>
</td>
<td align="left" valign="top">Now that you've seen the <a href="os_module.html" title="6.5.&#160;Working with Directories"><tt class="filename">os</tt></a> module, this line should make more sense.  It gets the extension of the file (<tt class="literal">os.path.splitext(filename)[1]</tt>), forces it to uppercase (<tt class="literal">.upper()</tt>), slices off the dot (<tt class="literal">[1:]</tt>), and constructs a class name out of it with string formatting.  So <tt class="filename">c:\music\ap\mahadeva.mp3</tt> becomes <tt class="literal">.mp3</tt> becomes <tt class="literal">.MP3</tt> becomes <tt class="literal">MP3</tt> becomes <tt class="literal">MP3FileInfo</tt>.
                     </td>
</tr>
<tr>
<td align="left" valign="top" width="12"><a href="#fileinfo.alltogether.1.5"><img alt="5" border="0" height="12" src="../images/callouts/5.png" width="12"/></a>
</td>
<td align="left" valign="top">Having constructed the name of the handler class that would handle this file, you check to see if that handler class actually
                        exists in this module.  If it does, you return the class, otherwise you return the base class <tt class="classname">FileInfo</tt>.  This is a very important point: <span class="emphasis"><em>this function returns a class</em></span>.  Not an instance of a class, but the class itself.
                     </td>
</tr>
<tr>
<td align="left" valign="top" width="12"><a href="#fileinfo.alltogether.1.6"><img alt="6" border="0" height="12" src="../images/callouts/6.png" width="12"/></a>
</td>
<td align="left" valign="top">For each file in the &#8220;<span class="quote">interesting files</span>&#8221; list (<tt class="varname">fileList</tt>), you call <tt class="function">getFileInfoClass</tt> with the filename (<tt class="varname">f</tt>).  Calling <tt class="literal">getFileInfoClass(f)</tt> returns a class; you don't know exactly which class, but you don't care.  You then create an instance of this class (whatever
                        it is) and pass the filename (<tt class="varname">f</tt> again), to the <tt class="function">__init__</tt> method.  As you saw <a href="../object_oriented_framework/special_class_methods.html#fileinfo.specialmethods.setname" title="Example&#160;5.15.&#160;Setting an MP3FileInfo's name">earlier in this chapter</a>, the <tt class="function">__init__</tt> method of <tt class="classname">FileInfo</tt> sets <tt class="literal">self["name"]</tt>, which triggers <tt class="function">__setitem__</tt>, which is overridden in the descendant (<tt class="classname">MP3FileInfo</tt>) to parse the file appropriately to pull out the file's metadata.  You do all that for each interesting file and return a
                        list of the resulting instances.
                     </td>
</tr>
</table>
</div>
</div>
<p>Note that <tt class="function">listDirectory</tt> is completely generic.  It doesn't know ahead of time which types of files it will be getting, or which classes are defined
            that could potentially handle those files.  It inspects the directory for the files to process, and then introspects its own
            module to see what special handler classes (like <tt class="classname">MP3FileInfo</tt>) are defined.  You can extend this program to handle other types of files simply by defining an appropriately-named class:
            <tt class="classname">HTMLFileInfo</tt> for <span class="acronym">HTML</span> files, <tt class="classname">DOCFileInfo</tt> for <span class="application">Word</span> <tt class="literal">.doc</tt> files, and so forth.  <tt class="function">listDirectory</tt> will handle them all, without modification, by handing off the real work to the appropriate classes and collating the results.
         </p>
</div>

            </div>
        </div>
        <div class="row">
            <div class="small-12 columns">
        
    <table border="0" cellpadding="0" cellspacing="0" class="Footer" summary="" width="100%">
<tr>
<td align="left" width="35%"><br><a class="NavigationArrow" href="os_module.html">&lt;&lt;&#160;Working with Directories</a></br></td>
<td align="center" width="30%"><br>&#160;<span class="divider">|</span>&#160;<a href="index.html#fileinfo.exception" title="6.1.&#160;Handling Exceptions">1</a> <span class="divider">|</span> <a href="file_objects.html" title="6.2.&#160;Working with File Objects">2</a> <span class="divider">|</span> <a href="for_loops.html" title="6.3.&#160;Iterating with for Loops">3</a> <span class="divider">|</span> <a href="more_on_modules.html" title="6.4.&#160;Using sys.modules">4</a> <span class="divider">|</span> <a href="os_module.html" title="6.5.&#160;Working with Directories">5</a> <span class="divider">|</span> <span class="thispage">6</span> <span class="divider">|</span> <a href="summary.html" title="6.7.&#160;Summary">7</a>&#160;<span class="divider">|</span>&#160;
            </br></td>
<td align="right" width="35%"><br><a class="NavigationArrow" href="summary.html">Summary&#160;&gt;&gt;</a></br></td>
</tr>
<tr>
<td colspan="3"><br/></td>
</tr>
</table>

        <!-- Footer -->
<div class="Footer">
    <p><a href="https://github.com/pcsforeducation/diveintopython/issues?sort=created&state=open">Report issues<img style="margin-left:10px" height="40" src="../images/logo_github.png"></a></p>
    <p class="copyright">Copyright &copy; 2000, 2001, 2002, 2003, 2004 <a href="mailto:josh@servercobra.com">Mark Pilgrim</a>. Maintained by Josh Gachnang.</p>
</div>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-1879314568120827";
/* DiveIntoPython */
google_ad_slot = "8002881514";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<!-- End Footer -->
            </div>
        </div>
        <!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- End Google Analytics -->
        <script src="../js/jquery.js"></script>
        <script src="../js/foundation.min.js"></script>
        <script>
          $(document).foundation();
        </script>
    </body>
</html>