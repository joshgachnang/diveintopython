
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>3.10. Handling exceptions</title><link rel="stylesheet" href="/css/diveintopython.css" type="text/css" /><link rev="made" href="josh@servercobra.com" /><meta name="generator" content="DocBook XSL Stylesheets V" /><meta name="keywords" content="Python, язык Python, язык программирования Python, Dive Into Python, В глубь языка Python, учебник, объектно-ориентированный, программирование, документация, книга, free, свободный, бесплатный" /><meta name="description" content="a free Python book for experienced programmers" /><link rel="home" href="http://ru.diveintopython.net/" title="В глубь языка Python" /><link rel="up" href="http://ru.diveintopython.net/" title="Глава 3. Средства объектно-ориентированного программирования" /><link rel="previous" href="http://ru.diveintopython.net/" title="3.9. Private functions" /><link rel="next" href="http://ru.diveintopython.net/" title="3.11. File objects" /><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9740779-18']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body>
<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<table id="Header" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td id="breadcrumb" colspan="5" align="left"><a href="http://ru.diveintopython.net/index.html">&#1053;&#1072;&#1095;&#1072;&#1083;&#1086;</a>&nbsp;&gt;&nbsp;<a href="http://ru.diveintopython.net/toc.html">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</a>&nbsp;&gt;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_divein.html">&#1057;&#1088;&#1077;&#1076;&#1089;&#1090;&#1074;&#1072; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1085;&#1086;-&#1086;&#1088;&#1080;&#1077;&#1085;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1085;&#1086;&#1075;&#1086; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103;</a>&nbsp;&gt;&nbsp;<b>Handling exceptions</b></td><td id="navigation" align="right">&nbsp;&nbsp;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_private.html" title="Пред.: “Private functions”">&lt;&lt;</a>&nbsp;&nbsp;&nbsp;<a href="http://ru.diveintopython.net/fileinfo_files.html" title="След.: “File objects”">&gt;&gt;</a></td></tr><tr><td><img src="http://ru.diveintopython.net/images/logo.png" alt="diveinto.python.ru" /></td><td colspan="2"><span id="logo">&#1042; &#1075;&#1083;&#1091;&#1073;&#1100; &#1103;&#1079;&#1099;&#1082;&#1072; Python</span><br /><span id="tagline">&#1044;&#1083;&#1103; &#1087;&#1088;&#1086;&#1075;&#1088;&#1072;&#1084;&#1084;&#1080;&#1089;&#1090;&#1086;&#1074;</span></td><td colspan="3" align="right"></td></tr></table><div class="section"><a name="fileinfo.exception"></a><div class="titlepage"><div><h2 class="title"><a name="fileinfo.exception"></a>3.10. Handling exceptions</h2></div></div><div class="abstract"><p>Like many object-oriented languages, Python has exception handling via <tt>try...except</tt> blocks.</p></div><a name="compare.exceptions.java"></a><table class="note" border="0"><tr><td rowspan="2" align="center" valign="top" width="24"><img src="http://ru.diveintopython.net/images/note.png" alt="Замечание" width="24" height="24" /></td></tr><tr><td colspan="2" align="left" valign="top">Python uses <tt>try...except</tt> to handle exceptions and <tt>raise</tt> to generate them.  Java and C++ use <tt>try...catch</tt> to handle exceptions, and <tt>throw</tt> to generate them.</td></tr></table><p>If you already know all about exceptions, you can skim this section.  If you've been stuck programming in a lesser language that doesn't have exception handling, or you've been using a real language but not using exceptions, this section is very important.</p><p>Exceptions are everywhere in Python; virtually every module in the standard Python library uses them, and Python itself will raise them in lots of different circumstances.  You've already seen them repeatedly throughout this book.</p><div class="itemizedlist"><ul><li><a href="http://ru.diveintopython.net/odbchelper_dict.html#odbchelper.dict.define" title="Пример 1.9. Определени словарей">Accessing a non-existent dictionary key</a> will raise a <tt>KeyError</tt> exception.</li><li><a href="http://ru.diveintopython.net/odbchelper_list.html#odbchelper.list.search" title="Пример 1.19. Поиск в списке">Searching a list for a non-existent value</a> will raise a <tt>ValueError</tt> exception.</li><li><a href="http://ru.diveintopython.net/odbchelper_tuple.html#odbchelper.tuplemethods" title="Пример 1.23. У кортежей нет методов">Calling a non-existent method</a> will raise an <tt>AttributeError</tt> exception.</li><li><a href="http://ru.diveintopython.net/odbchelper_vardef.html#odbchelper.unboundvariable" title="Пример 1.25. Использование несуществующей переменной">Referencing a non-existent variable</a> will raise a <tt>NameError</tt> exception.</li><li><a href="http://ru.diveintopython.net/odbchelper_stringformatting.html#odbchelper.stringformatting.coerce" title="Пример 1.29. Форматирование vs. объединение">Mixing datatypes without coercion</a> will raise a <tt>TypeError</tt> exception.</li></ul></div><p>In each of these cases, we were simply playing around in the Python IDE: an error occurred, the exception was printed (depending on your IDE, in an intentionally jarring shade of red), and that was that.  This is called an <span class="emphasis"><i>unhandled</i></span> exception; when the exception was raised, there was no code to explicitly notice it and deal with it, so it bubbled its way back to the default behavior built in to Python, which is to spit out some debugging information and give up.  In the IDE, that's no big deal, but if that happened while your actual Python program was running, the entire program would come to a screeching halt.<sup>[<a name="d0e4145" href="http://ru.diveintopython.net/fileinfo_exception.html#ftn.d0e4145">6</a>]</sup></p><p>An exception doesn't have to be a complete program crash, though.  Exceptions, when raised, can be <span class="emphasis"><i>handled</i></span>.  Sometimes an exception is really because you have a bug in your code (like accessing a variable that doesn't exist), but many times, an exception is something you can plan for.  If you're opening a file, it might not exist; if you're connecting to a database, it might be unavailable, or you might not have the correct security credentials to access it.  If you know a line of code may raise an exception, you should handle the exception using a <tt>try...except</tt> block.</p><div class="example"><p><a name="d0e4150"></a><b>&#1055;&#1088;&#1080;&#1084;&#1077;&#1088; 3.21. Opening a non-existent file</b></p><pre class="screen"><tt>&gt;&gt;&gt; </tt><span class="userinput">fsock = open(<span class="pystring">"/notthere"</span>, <span class="pystring">"r"</span>)</span>      <a name="fileinfo.exceptions.1.1"></a><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" />
<span class="traceback">Traceback (innermost last):
  File "&lt;interactive input&gt;", line 1, in ?
IOError: [Errno 2] No such file or directory: '/notthere'</span>
<tt>&gt;&gt;&gt; </tt><span class="userinput"><span class="pykeyword">try</span>:</span>
<tt>...     </tt><span class="userinput">fsock = open(<span class="pystring">"/notthere"</span>)</span>       <a name="fileinfo.exceptions.1.2"></a><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" />
<tt>... </tt><span class="userinput"><span class="pykeyword">except</span> IOError:</span>                     <a name="fileinfo.exceptions.1.3"></a><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" />
<tt>...     </tt><span class="userinput"><span class="pykeyword">print</span> <span class="pystring">"The file does not exist, exiting gracefully"</span></span>
<tt>... </tt><span class="userinput"><span class="pykeyword">print</span> <span class="pystring">"This line will always print"</span></span> <a name="fileinfo.exceptions.1.4"></a><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" />
<span class="computeroutput">The file does not exist, exiting gracefully
This line will always print</span></pre><div class="calloutlist"><a name="d0e4171"></a><table border="0" summary="Callout list"><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.1.1"><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">Using the built-in <tt>open</tt> function, we can try to open a file for reading (more on <tt>open</tt> in the next section).  But the file doesn't exist, so this raises the <tt>IOError</tt> exception.  Since we haven't provided any explicit check for an <tt>IOError</tt> exception, Python just prints out some debugging information about what happened and then gives up.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.1.2"><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">We're trying to open the same non-existent file, but this time we're doing it within a <tt>try...except</tt> block.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.1.3"><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">When the <tt>open</tt> method raises an <tt>IOError</tt> exception, we're ready for it.  The <tt>except IOError:</tt> line catches the exception and executes our own block of code, which in this case just prints a more pleasant error message.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.1.4"><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">Once an exception has been handled, processing continues normally on the first line after the <tt>try...except</tt> block.  Note that this line will always print, whether or not an exception occurs.  If you really did have a file called <tt>notthere</tt> in your root directory, the call to <tt>open</tt> would succeed, the <tt>except</tt> clause would be ignored, and this line would still be executed.</td></tr></table></div></div><p>Exceptions may seem unfriendly (after all, if you don't catch the exception, your entire program will crash), but consider the alternative.  Would you rather get back an unusable file object to a non-existent file?  You'd have to check its validity somehow anyway, and if you forgot, your program would give you strange errors somewhere down the line that you would have to trace back to the source.  I'm sure you've done this; it's not fun.  With exceptions, errors occur immediately, and you can handle them in a standard way at the source of the problem.</p><p>There are lots of other uses for exceptions besides handling actual error conditions.  A common use in the standard Python library is to try to import a module, then check whether it worked.  Importing a module that does not exist will raise an <tt>ImportError</tt> exception.  You can use this to define multiple levels of functionality based on which modules are available at run-time, or to support multiple platforms (where platform-specific code is separated into different modules).</p><div class="example"><p><a name="crossplatform.example"></a><b>&#1055;&#1088;&#1080;&#1084;&#1077;&#1088; 3.22. Supporting platform-specific functionality</b></p><p>This code comes from the <tt>getpass</tt> module, a wrapper module for getting a password from the user.  Getting a password is accomplished differently on UNIX, Windows, and Mac OS platforms, but this code encapsulates all of those differences.</p><pre class="programlisting">
  <span class="pycomment"># Bind the name getpass to the appropriate function</span>
  <span class="pykeyword">try</span>:
      <span class="pykeyword">import</span> termios, TERMIOS                     <a name="fileinfo.exceptions.2.1"></a><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" />
  <span class="pykeyword">except</span> ImportError:
      <span class="pykeyword">try</span>:
          <span class="pykeyword">import</span> msvcrt                           <a name="fileinfo.exceptions.2.2"></a><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" />
      <span class="pykeyword">except</span> ImportError:
          <span class="pykeyword">try</span>:
              <span class="pykeyword">from</span> EasyDialogs <span class="pykeyword">import</span> AskPassword <a name="fileinfo.exceptions.2.3"></a><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" />
          <span class="pykeyword">except</span> ImportError:
              getpass = default_getpass           <a name="fileinfo.exceptions.2.4"></a><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" />
          <span class="pykeyword">else</span>:                                   <a name="fileinfo.exceptions.2.5"></a><img src="http://ru.diveintopython.net/images/callouts/5.png" alt="5" border="0" width="12" height="12" />
              getpass = AskPassword
      <span class="pykeyword">else</span>:
          getpass = win_getpass
  <span class="pykeyword">else</span>:
      getpass = unix_getpass</pre><div class="calloutlist"><a name="d0e4210"></a><table border="0" summary="Callout list"><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.2.1"><img src="http://ru.diveintopython.net/images/callouts/1.png" alt="1" border="0" width="12" height="12" /></a> </td><td valign="top" align="left"><tt>termios</tt> is a UNIX-specific module that provides low-level control over the input terminal.  If this module is not available (because it's not on your system, or your system doesn't support it), the import fails and Python raises an <tt>ImportError</tt>, which we catch.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.2.2"><img src="http://ru.diveintopython.net/images/callouts/2.png" alt="2" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">OK, we didn't have <tt>termios</tt>, so let's try <tt>msvcrt</tt>, which is a Windows-specific module that provides an API to lots of useful functions in the Microsoft Visual C++ runtime services.  If this import fails, Python will raise an <tt>ImportError</tt>, which we catch.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.2.3"><img src="http://ru.diveintopython.net/images/callouts/3.png" alt="3" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">If the first two didn't work, we try to import a function from <tt>EasyDialogs</tt>, which is a Mac OS-specific module that provides functions to pop up dialogs of various types.  Once again, if this import fails, Python will raise an <tt>ImportError</tt>, which we catch.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.2.4"><img src="http://ru.diveintopython.net/images/callouts/4.png" alt="4" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">None of these platform-specific modules is available (which is possible, since Python has been ported to lots of different platforms), so we have to fall back on a default password input function (which is defined elsewhere in the <tt>getpass</tt> module).  Notice what we're doing here: we're assigning the function <tt>default_getpass</tt> to the variable <tt>getpass</tt>.  If you read the official <tt>getpass</tt> documentation, it tells you that the <tt>getpass</tt> module defines a <tt>getpass</tt> function.  This is how it does it: by binding <tt>getpass</tt> to the right function for your platform.  Then when you call the <tt>getpass</tt> function, you're really calling a platform-specific function that this code has set up for you.  You don't have to know or care what platform your code is running on; just call <tt>getpass</tt>, and it will always do the right thing.</td></tr><tr><td width="12" valign="top" align="left"><a href="http://ru.diveintopython.net/fileinfo_exception.html#fileinfo.exceptions.2.5"><img src="http://ru.diveintopython.net/images/callouts/5.png" alt="5" border="0" width="12" height="12" /></a> </td><td valign="top" align="left">A <tt>try...except</tt> block can have an <tt>else</tt> clause, like an <tt>if</tt> statement.  If no exception is raised during the <tt>try</tt> block, the <tt>else</tt> clause is executed afterwards.  In this case, that means that the <tt>from EasyDialogs import AskPassword</tt> import worked, so we should bind <tt>getpass</tt> to the <tt>AskPassword</tt> function.  Each of the other <tt>try...except</tt> blocks have similar <tt>else</tt> clauses to bind <tt>getpass</tt> to the appropriate function when we find an <tt>import</tt> that works.</td></tr></table></div></div><div class="furtherreading"><p><b>Further reading</b></p><ul><li><a href="http://ru.diveintopython.net/doc/current/tut/tut.html"><i>Python Tutorial</i></a> discusses exceptions, including <a href="http://ru.diveintopython.net/doc/current/tut/node10.html#SECTION0010400000000000000000">raising your own exceptions and handling multiple exceptions at once</a>.</li><li><a href="http://ru.diveintopython.net/doc/current/lib/"><i>Python Library Reference</i></a> summarizes <a href="http://ru.diveintopython.net/doc/current/lib/module-exceptions.html">all the built-in exceptions</a>.</li><li><a href="http://ru.diveintopython.net/doc/current/lib/"><i>Python Library Reference</i></a> documents the <a href="http://ru.diveintopython.net/doc/current/lib/module-getpass.html">getpass</a> module.</li><li><a href="http://ru.diveintopython.net/doc/current/lib/"><i>Python Library Reference</i></a> documents the <a href="http://ru.diveintopython.net/doc/current/lib/module-traceback.html"><tt>traceback</tt> module</a>, which provides low-level access to exception attributes after an exception is raised.</li><li><a href="http://ru.diveintopython.net/doc/current/ref/"><i>Python Reference Manual</i></a> discusses the inner workings of the <a href="http://ru.diveintopython.net/doc/current/ref/try.html"><tt>try...except</tt> block</a>.</li></ul></div><div class="footnotes"><p class="footnotetitle">Footnotes</p><div class="footnote"><p><sup>[<a name="ftn.d0e4145" href="http://ru.diveintopython.net/fileinfo_exception.html#d0e4145">6</a>] </sup>Or, as some marketroids would put it, your program would perform an illegal action.  Whatever.</p></div></div></div><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td width="35%" align="left"><br /><a href="http://ru.diveintopython.net/fileinfo_private.html"><span class="NavigationArrow">&lt;&lt;</span>&nbsp;Private functions</a></td><td width="30%" align="center"><br />&nbsp;<a href="http://ru.diveintopython.net/fileinfo_divein.html#fileinfo.divein" title="3.1. В глубь">1</a> <a href="http://ru.diveintopython.net/fileinfo_fromimport.html" title="3.2. Импортирование модулей инструкцией from module import">2</a> <a href="http://ru.diveintopython.net/fileinfo_class.html" title="3.3. Определение классов">3</a> <a href="http://ru.diveintopython.net/fileinfo_instantiation.html" title="3.4. Создание экземпляров классов">4</a> <a href="http://ru.diveintopython.net/fileinfo_userdict.html" title="3.5. UserDict: a wrapper class">5</a> <a href="http://ru.diveintopython.net/fileinfo_specialmethods.html" title="3.6. Special class methods">6</a> <a href="http://ru.diveintopython.net/fileinfo_morespecial.html" title="3.7. Advanced special class methods">7</a> <a href="http://ru.diveintopython.net/fileinfo_classattributes.html" title="3.8. Class attributes">8</a> <a href="http://ru.diveintopython.net/fileinfo_private.html" title="3.9. Private functions">9</a> <b>10</b> <a href="http://ru.diveintopython.net/fileinfo_files.html" title="3.11. File objects">11</a> <a href="http://ru.diveintopython.net/fileinfo_for.html" title="3.12. for loops">12</a> <a href="http://ru.diveintopython.net/fileinfo_modules.html" title="3.13. More on modules">13</a> <a href="http://ru.diveintopython.net/fileinfo_os.html" title="3.14. The os module">14</a> <a href="http://ru.diveintopython.net/fileinfo_alltogether.html" title="3.15. Putting it all together">15</a> <a href="http://ru.diveintopython.net/fileinfo_summary.html" title="3.16. Summary">16</a>&nbsp;</td><td width="35%" align="right"><br /><a href="http://ru.diveintopython.net/fileinfo_files.html">File objects&nbsp;<span class="NavigationArrow">&gt;&gt;</span></a></td></tr><tr><td colspan="3"><br /></td></tr></table><table class="Footer" width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td align="left"><p class="copyright">Copyright &copy; 2000, 2001, 2002 <a href="mailto:josh@servercobra.com">&#1052;&#1072;&#1088;&#1082; &#1055;&#1080;&#1083;&#1075;&#1088;&#1080;&#1084;</a></p><p class="copyright">Copyright &copy; 2001, 2002, 2003 &#1055;&#1077;&#1088;&#1077;&#1074;&#1086;&#1076;, <a href="mailto:josh@servercobra.com">&#1044;&#1077;&#1085;&#1080;&#1089; &#1054;&#1090;&#1082;&#1080;&#1076;&#1072;&#1095;</a></p></td><td align="left">&nbsp;</td></tr></table></body></html>
